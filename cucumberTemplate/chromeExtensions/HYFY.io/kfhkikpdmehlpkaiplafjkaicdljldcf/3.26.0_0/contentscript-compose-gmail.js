!function(){var a=window.logModule.getLogger("ComposeGmailContentScript"),b=window.EXTENSION_SETTINGS.siteBaseUrl,c=window.EXTENSION_SETTINGS.staticBaseUrl,d={},e=new RegExp(b+"/v/(.*?)/","g"),f=new RegExp("videos-gifs/HYFY-RECORDING-(.*?)-","g"),g="/images/default-thumbnail.jpg",h='<div><br><a href="play_url"> <table style="background-image:url(thumbnail_url); height:188px; width:300px;border-collapse: collapse; margin-top:12px; background-size: contain; background-position: center; background-repeat: no-repeat;"><tr><td style="background-color:rgba(55,55,55,0.5);height:100%; width:100%;"><table  style="background:#ffffff;height:36px; width:36px;margin:auto;border-radius:50%;"><tr><td style="height:100%; width:100%;"><img style="width:12px;height:18px; margin-left:10px;margin-top:3px;" src="play_icon_url"></img></td></tr></table></td></tr></table></a><br><a href="play_url" style="text-decoration:none;color:#3EBBF7;font-family:Arial;font-size:14px;line-height:16px;padding-bottom:10px;">video_title</a></div>',i='<div><br><a href="play_url"><table style="height:188px; width:300px;border-collapse: collapse;margin-top:12px;"><tr style="border:1px solid rgb(231,231,231)"><td style="background-color:rgba(55,55,55,0.5);height:100%; width:100px;background-repeat: no-repeat;background-size:cover;background-position:center center;background-image:url(facecam_url)"></td><td style="background-color:rgba(55,55,55,0.5);height:100%; width:200px;background-repeat: no-repeat;background-size:cover;background-position:center center;background-image:url(thumbnail_url)"><table  style="background:#ffffff;height:36px; width:36px;margin:auto;border-radius:50%;margin-left:32px"><tr><td style="height:100%; width:100%;"><img style="width:12px;height:18px; margin-left:10px;margin-top:3px;" src="play_icon_url"></img></td></tr></table></td></tr></table></a><br><a href="play_url" style="text-decoration:none;color:#3EBBF7;font-family:Arial;font-size:14px;line-height:16px;padding-bottom:10px;">video_title</a><br></div>',j='<div><br><div><table style="height:188px; width:300px;border-collapse: collapse; margin-top:12px;"><tr><td style="height:100%; width:100%;"><img style="max-width: 1024px;" src=thumbnail_url></td></tr></table></div><br><div style="text-decoration:none;font-family:Arial;font-size:14px;line-height:16px;padding-bottom:10px;">video_title</div></div>',k=c+"/images/play-icon-pink-48x68.png";a.debug("contentscript-compose-gmail","executing"),$("body").on("input","[contenteditable]",function(){var a=$(this),b=a.html(),c=a.find(":not(.gmail-placeholder).gmail-hyfy-card");c.each(function(){0==$(this).find("img").length&&$(this).remove()});var d=l(e,b);if(d&&Object.keys(d).length>0)for(var g in d)d.hasOwnProperty(g)&&m(a,g,d[g].match,window.urlsModule.API_URLS.videos.videoShareDetail);var d=l(f,b);if(d&&Object.keys(d).length>0)for(var g in d)d.hasOwnProperty(g)&&m(a,g,d[g].match,window.urlsModule.API_URLS.videos.gifShareDetail)});var l=function(a,b){var c,d={};do c=a.exec(b),c&&(0===c.index||'"'!==b.charAt(c.index-1))&&(d[c[0]]?d[c[0]].indexes.push(c.index):d[c[0]]={match:c[1],indexes:[c.index]});while(c);return d},m=function(b,e,f,l){a.info("_unfurlUrl","entering");var m=b.find(".gmail-"+f);if(0===m.length)if(m=$("<div></div>"),m.addClass("gmail-"+f),m.addClass("gmail-hyfy-card"),m.addClass("gmail-placeholder"),b.append(m),d[e]){var n=$(d[e]);m.removeClass("gmail-placeholder"),m.append(n),b.trigger("change")}else BackgndAPI.fetchMailShareVideoDetail({videoId:f,url:l},function(d){if(a.info("_unfurlUrl","got video details",d),d&&d.thumbnailUrl&&d.videoUrl){var e=d.thumbnailUrl;if(e.indexOf(g)>=0&&(e=c+g),e=encodeURIComponent(e),d.sourceType==window.constantsModule.VIDEO_SOURCE_TYPE.VIDEO){var l;switch(d.playMode){case window.constantsModule.VIDEO_PLAY_MODE.FACECAM_AND_SCREEN:d.hasOwnProperty("screenGIFThumbnailUrl")&&d.hasOwnProperty("facecamGIFThumbnailUrl")&&d.facecamGIFThumbnailUrl&&d.screenGIFThumbnailUrl?(l=i.replace("facecam_url",d.facecamGIFThumbnailUrl),l=l.replace("thumbnail_url",d.screenGIFThumbnailUrl)):(l=i.replace("facecam_url",d.facecamThumbnailUrl),l=l.replace("thumbnail_url",d.thumbnailUrl));break;case window.constantsModule.VIDEO_PLAY_MODE.FACECAM:l=d.hasOwnProperty("facecamGIFThumbnailUrl")&&d.facecamGIFThumbnailUrl?h.replace("thumbnail_url",d.facecamGIFThumbnailUrl):h.replace("thumbnail_url",d.facecamThumbnailUrl);break;case window.constantsModule.VIDEO_PLAY_MODE.SCREEN:l=d.hasOwnProperty("screenGIFThumbnailUrl")&&d.screenGIFThumbnailUrl?h.replace("thumbnail_url",d.screenGIFThumbnailUrl):h.replace("thumbnail_url",d.thumbnailUrl)}l=l.replace("play_icon_url",k)}else l=j.replace("thumbnail_url",d.thumbnailUrl);l=l.replace(/\play_url/g,d.videoUrl),l=l.replace("video_id",f),l=d.titleEdited?l.replace("video_title",d.title):l.replace("video_title","");var m=$(l),n=b.find(".gmail-"+f);n.removeClass("gmail-placeholder"),n.append(m),b.trigger("change")}else a.warn("failed to fetch video detail")})}}();
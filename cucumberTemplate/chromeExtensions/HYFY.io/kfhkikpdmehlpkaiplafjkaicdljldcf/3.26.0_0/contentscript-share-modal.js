var Nanobar=function(){var c,d,e,f,g,h,k={width:"100%",height:"4px",zIndex:9999,top:"0"},l={width:0,height:"100%",clear:"both",transition:"height .3s"};c=function(a,b){for(var c in b)a.style[c]=b[c];a.style["float"]="left"};f=function(){var a=this,b=this.width-this.here;0.1>b&&-0.1<b?(g.call(this,this.here),this.moving=!1,100==this.width&&(this.el.style.height=0,setTimeout(function(){a.cont.el.removeChild(a.el)},300))):(g.call(this,this.width-b/4),setTimeout(function(){a.go()},16))};g=function(a){this.width=
a;this.el.style.width=this.width+"%"};h=function(){var a=new d(this);this.bars.unshift(a)};d=function(a){this.el=document.createElement("div");this.el.style.backgroundColor=a.opts.bg;this.here=this.width=0;this.moving=!1;this.cont=a;c(this.el,l);a.el.appendChild(this.el)};d.prototype.go=function(a){a?(this.here=a,this.moving||(this.moving=!0,f.call(this))):this.moving&&f.call(this)};e=function(a){a=this.opts=a||{};var b;a.bg=a.bg||"#000";this.bars=[];b=this.el=document.createElement("div");c(this.el,
k);a.id&&(b.id=a.id);b.style.position=a.target?"relative":"fixed";a.target?a.target.insertBefore(b,a.target.firstChild):document.getElementsByTagName("body")[0].appendChild(b);h.call(this)};e.prototype.go=function(a){this.bars[0].go(a);100==a&&h.call(this)};return e}();
"use strict";!function(){var a,b,c,d,e=window.logModule.getLogger("ShareModalContentScript"),f="hyfy-extension-event",g="hyfy-status-iframe",h=!1,i=function(){e.debug("_attachMessageListener","entering"),chrome.runtime.onMessage.addListener(k)},j=function(){e.debug("_removeMessageListener","entering"),chrome.runtime.onMessage.removeListener(k)},k=function(a,b,c){switch(a.message){case window.constantsModule.JS_MESSAGES.DISABLE_CONTENT_SCRIPT:e.info("_messageListener","processing",a),u();break;case window.constantsModule.JS_MESSAGES.UPDATE_RECORDING_STATUS:l(a.statusUpdate)}},l=function(a){var b=a.recordingStatus;switch(a.type){case window.constantsModule.RECORDING_EVENTS.STATE_CHANGE:m(b);break;case window.constantsModule.RECORDING_EVENTS.PROGRESS:switch(b.state){case window.constantsModule.RECORDING_STATES.UPLOADING:b.uploadProgress&&n(b.uploadProgress)}}},m=function(a){switch(a.state){case window.constantsModule.RECORDING_STATES.PROCESSING:case window.constantsModule.RECORDING_STATES.UPLOADING:a.duration&&(e.info("_handleRecordingStatusUpdate","updating duration",a.duration),o(a.duration)),n(0),s();break;case window.constantsModule.RECORDING_STATES.COMPLETED:s(),n(100,!0);break;case window.constantsModule.RECORDING_STATES.RECORDING_FAILED:case window.constantsModule.RECORDING_STATES.UPLOAD_FAILED:r();break;case window.constantsModule.RECORDING_STATES.DISCARDING:h||self.close()}},n=function(a,b){if(d&&-1==d.indexOf(window.constantsModule.FEATURES.HIDE_UPLOAD_PROGRESS_BAR)){e.debug("_updateUploadProgress","updating progress",a);var f=$(".js-nanobar-background");if(b)c&&(c.go(100),f.hide());else{if(void 0==c){var g={id:"ajaxLoader",bg:"#E91E63",target:document.getElementById("ajaxLoaderContainer")};c=new window.Nanobar(g)}f.is(":hidden")&&f.show(),c&&c.go(95>a?a:95)}}},o=function(a){e.debug("_updateDuration","updating duration",a);var b=Math.floor(a/60),c=a%60;10>c&&(c="0"+c),$(".js-duration").html("("+b+":"+c+")")},p=function(){e.info("_init","initializing"),BackgndAPI.getCurrentTabId({},function(c){a=c.tabId,BackgndAPI.fetchRecordingStatus({tabId:a},function(c){c?(e.info("_init","got recording status",c.recordingId),b=c.recordingId,q(),window.clientUtilsModule.getUserFeatures(function(a){d=a,e.info("_init","got user features",d)}),void 0!=c.duration&&(e.info("_init","updating duration",c.duration),o(c.duration)),BackgndAPI.fetchThumbnailUrl({tabId:a},function(a){e.info("_init","updating thumbnail"),document.dispatchEvent(new CustomEvent(f,{detail:{type:"update-thumbnail",thumbnailData:a.thumbnailData}}))}),m(c)):e.debug("_init","recording status not found for this tab"),$(document).on("click",".js-delete-video",function(){e.debug("_init","delete video"),h=!0,BackgndAPI.deleteVideo({recordingId:b})})}),i()})},q=function(a,c){e.info("_embedStatusIframe","entering",{show:c}),t();var d=$("<iframe></iframe>");$("body").append(d),d.attr({id:g,src:window.utilsModule.getLocalUrl(window.window.urlsModule.LOCAL_URLS.templates.recording_status).replace(":recordingId",b),scrolling:"no"}),c&&d.show()},r=function(){e.info("_showStatusIframe","entering"),$("#"+g).show()},s=function(){e.info("_hideStatusIframe","entering"),$("#"+g).hide()},t=function(){e.info("_removeStatusIframe","entering"),$("#"+g).remove()},u=function(){e.info("_destroy","entering"),j()};$(document).ready(function(){p()})}();
"use strict";var HYFY=window.HYFY||{};HYFY.RecordingControls=function(){function a(a,e){c=window.logModule.getLogger("RecordingControls-rec-"+e.recordingId),b=this,b.params=e,b.$container=$("#"+a),b.$container.addClass("hyfyext-recording-controls-container"),b.$recordingControls=b.$container.find(".js-hyfyext-recording-controls"),b.$mainControls=b.$container.find(".js-main-controls-section"),b.$moveHandle=b.$container.find(".js-move-handle"),b.$countdownButton=b.$container.find(".js-countdown-button"),b.$countdownVal=b.$container.find(".js-countdown-val"),b.$timerVal=b.$container.find(".js-timer-val"),b.$stopButton=b.$container.find(".js-stop-button"),j(b.$stopButton,d.stop),b.$pauseResumeSection=b.$container.find(".js-pause-resume"),b.$pauseButton=b.$container.find(".js-pause-button"),j(b.$pauseButton,d.pause),b.$resumeButton=b.$container.find(".js-resume-button"),j(b.$resumeButton,d.resume),b.$hideButton=b.$container.find(".js-hide-button"),j(b.$hideButton,d.hide),b.$deleteButton=b.$container.find(".js-delete-button"),j(b.$deleteButton,d.discard),b.$supportButton=b.$container.find(".js-support-button"),j(b.$supportButton,d.support),b.$tooltipButton=b.$container.find(".js-tooltip-button"),b.tooltipDelayTimeout=null,b.init()}var b,c,d={stop:window.constantsModule.RECORDING_CONTROLS_TOOLTIPS.STOP,pause:window.constantsModule.RECORDING_CONTROLS_TOOLTIPS.PAUSE,resume:window.constantsModule.RECORDING_CONTROLS_TOOLTIPS.RESUME,hide:window.constantsModule.RECORDING_CONTROLS_TOOLTIPS.HIDE,discard:window.constantsModule.RECORDING_CONTROLS_TOOLTIPS.DISCARD,support:window.constantsModule.RECORDING_CONTROLS_TOOLTIPS.SUPPORT},e=2e3,f=function(a){a.addClass("hyfy-hide")},g=function(a){a.removeClass("hyfy-hide")},h=function(a,b){a.text(b)},i=function(a){var b="";if(null!=a&&void 0!=a){var c=Math.floor(a/60),d=a%60;b=c+":",10>d&&(b+="0"),b+=d}return b},j=function(a,b){a.find(".js-tooltip-val").html(b)};return a.prototype.init=function(){BackgndAPI.fetchRecordingStatus({recordingId:b.params.recordingId},function(a){a&&b.initActiveRecording(a),b.attachMessageListener(),b.bindEvents()})},a.prototype.bindEvents=function(){b.$stopButton.on("click",b.stopRecording),b.$pauseButton.on("click",b.pauseRecording),b.$resumeButton.on("click",b.resumeRecording),b.$hideButton.on("click",b.hideControls),b.$deleteButton.on("click",b.discardRecording),b.$supportButton.on("click",b.openSupportUrl),b.$tooltipButton.on("mouseenter",b.showTooltip),b.$tooltipButton.on("mouseleave",b.hideTooltip),b.bindMovement()},a.prototype.bindMovement=function(){var a=function(a){b.$container.addClass("hyfyext-drag-active");var d=$("body").css("-webkit-user-select");$("body").css("-webkit-user-select","none");var e=b.$container.width(),f=b.$container.height(),g=$(window).width(),h=$(window).height(),i=$(window).scrollTop(),j=$(window).scrollLeft(),k=30,l=g-e-k,m=30,n=h-f-m,o={left:b.$container.offset().left-j,top:b.$container.offset().top-i},p={left:a.clientX-o.left,top:a.clientY-o.top},q=void 0,r=function(a){var c=a.clientX-p.left,d=a.clientY-p.top;k>c?c=k:c>l&&(c=l),m>d?d=m:d>n&&(d=n);var i=c,j=d,o=g-e-c,r=h-f-d,s={top:!0,left:!1};i>g/2?i="auto":(o="auto",s.left=!0),j>h/2?(j="auto",s.top=!1):r="auto",b.$container.css({top:j,left:i,right:o,bottom:r}),q={top:j,left:i,right:o,bottom:r,layout:s}},s=function(a){$("body").css("-webkit-user-select",d),b.$container.removeClass("hyfyext-drag-active"),$(document).off("mousemove",r),$(document).off("mouseup",s),q&&(c(q),BackgndAPI.updateClientProperty({property:window.constantsModule.RECORDING_CLIENT_PROPS.FAB_POSITION,value:q}))};$(document).on("mousemove",r),$(document).on("mouseup",s)},c=function(a){b.$container.css({top:a.top,left:a.left,right:a.right,bottom:a.bottom}),b.$container.removeClass("hyfyext-layout-top"),b.$container.removeClass("hyfyext-layout-bottom"),b.$container.removeClass("hyfyext-layout-left"),b.$container.removeClass("hyfyext-layout-right"),a.layout.top?b.$container.addClass("hyfyext-layout-top"):b.$container.addClass("hyfyext-layout-bottom"),a.layout.left?b.$container.addClass("hyfyext-layout-left"):b.$container.addClass("hyfyext-layout-right")};c(b.params.position),b.$moveHandle.on("mousedown",a)},a.prototype.attachMessageListener=function(){c.debug("attachMessageListener","entering"),chrome.runtime.onMessage.addListener(b.messageListener)},a.prototype.removeMessageListener=function(){c.debug("removeMessageListener","entering"),chrome.runtime.onMessage.removeListener(b.messageListener)},a.prototype.messageListener=function(a,d,e){switch(a.message){case window.constantsModule.JS_MESSAGES.DISABLE_CONTENT_SCRIPT:c.info("messageListener","processing",a),b.destroy();break;case window.constantsModule.JS_MESSAGES.UPDATE_RECORDING_STATUS:c.debug("messageListener","processing",a),b.handleRecordingStatusUpdate(a.statusUpdate)}},a.prototype.destroy=function(){c.info("destroy","entering"),b.removeMessageListener()},a.prototype.initActiveRecording=function(a){c.debug("initActiveRecording","entering"),b.handleRecordingStatusUpdate({type:window.constantsModule.RECORDING_EVENTS.STATE_CHANGE,recordingStatus:a})},a.prototype.handleRecordingStatusUpdate=function(a){var c=a.recordingStatus;if(b.params.recordingId==c.recordingId&&(b.handleRecordingProgressUpdate(c),a.type==window.constantsModule.RECORDING_EVENTS.STATE_CHANGE))switch(c.state){case window.constantsModule.RECORDING_STATES.NEW:case window.constantsModule.RECORDING_STATES.STARTING:case window.constantsModule.RECORDING_STATES.READY:case window.constantsModule.RECORDING_STATES.RUNNING_COUNTDOWN:f(b.$stopButton),b.$mainControls.addClass("hyfyext-countdown-active");break;case window.constantsModule.RECORDING_STATES.ACTIVE:f(b.$countdownButton),g(b.$stopButton),b.$mainControls.removeClass("hyfyext-countdown-active");break;case window.constantsModule.RECORDING_STATES.PROCESSING:case window.constantsModule.RECORDING_STATES.UPLOADING:case window.constantsModule.RECORDING_STATES.UPLOAD_FAILED:case window.constantsModule.RECORDING_STATES.DISCARDING:case window.constantsModule.RECORDING_STATES.COMPLETED:case window.constantsModule.RECORDING_STATES.RECORDING_FAILED:}},a.prototype.handleRecordingProgressUpdate=function(a){h(b.$timerVal,i(a.remainingTime)),a.state!=window.constantsModule.RECORDING_STATES.ACTIVE&&h(b.$countdownVal,Math.max(a.countdownTime,1))},a.prototype.stopRecording=function(){c.info("stopRecording","entering"),BackgndAPI.stopRecording()},a.prototype.discardRecording=function(){c.info("discardRecording","entering"),BackgndAPI.deleteVideo({recordingId:b.params.recordingId})},a.prototype.hideControls=function(){var a=window.constantsModule.RECORDING_CLIENT_PROPS.HIDE_FAB_MENU,b=!0;c.debug("hideControls","entering",{prop:a,value:b}),BackgndAPI.updateClientProperty({property:a,value:b})},a.prototype.pauseRecording=function(){c.info("pauseRecording","entering"),f(b.$pauseButton),g(b.$resumeButton),BackgndAPI.pauseRecording()},a.prototype.resumeRecording=function(){c.info("resumeRecording","entering"),f(b.$resumeButton),g(b.$pauseButton),BackgndAPI.resumeRecording()},a.prototype.openSupportUrl=function(){c.info("openSupportUrl","entering"),BackgndAPI.openAppUrl({url:window.urlsModule.SITE_URLS.support,skipPreAuth:!0})},a.prototype.setTooltipVisible=function(a){a?b.$recordingControls.addClass("hyfyext-tooltip-visible"):b.$recordingControls.removeClass("hyfyext-tooltip-visible")},a.prototype.showTooltip=function(){b.tooltipDelayTimeout&&clearTimeout(b.tooltipDelayTimeout),b.tooltipDelayTimeout=setTimeout(function(){b.setTooltipVisible(!0)},e)},a.prototype.hideTooltip=function(){b.tooltipDelayTimeout&&clearTimeout(b.tooltipDelayTimeout),b.setTooltipVisible(!1)},a}();
"use strict";!function(){var a=window.logModule.getLogger("RecordingContentScript"),b=function(){a.debug("_init","entering")};$(document).ready(function(){b()})}();